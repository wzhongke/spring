<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.4.0/vue.js"></script>
	<!-- vuex -->
	<script type="text/javascript" src="https://unpkg.com/vuex"></script>
	<title>vue components</title>
</head>
<body>
<!--
	props: å¯ä»¥ä»å¤–éƒ¨çš„ç¯å¢ƒå°†æ•°æ®ä¼ é€’åˆ°ç»„ä»¶ä¸­
	events: å…è®¸ç»„ä»¶è§¦å‘å¤–éƒ¨çš„äº‹ä»¶
	slots: å®ƒä»¬å…è®¸å¤–éƒ¨ç¯å¢ƒç»„æˆç»„ä»¶çš„å†…å®¹

-->

<!-- `template`æ–¹æ³•åœ¨å±•ç¤ºæ•°æ®çš„æ—¶å€™ä½¿ç”¨ï¼Œ`render`å‡½æ•°åœ¨æˆ‘ä»¬æƒ³è¦é€šè¿‡ç¨‹åºæ§åˆ¶å±•ç¤ºçš„æ—¶å€™ä½¿ç”¨ -->
	<div id="app">
		<thanks gift="Batman" decoration="strong"></thanks>
	</div>
	<script type="text/javascript">
		// ä½¿ç”¨ render function æ³¨å†Œç»„ä»¶
		Vue.component('thanks', {
			// æ ‡å¿—ä¸ºå‡½æ•°å¼çš„ï¼Œè¡¨æ˜è¯¥ç»„ä»¶ä¸­ä¸èƒ½åŒ…å«ä»»ä½•æ•°æ®
			// ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ é€šè¿‡ä¼ é€’çš„å‚æ•°æ¥è¾“å‡ºç»“æœ
			// `render`å‡½æ•°åœ¨ç»„ä»¶è¢«ç”»åˆ°å±å¹•ä¸Šæ—¶è¢«è°ƒç”¨
			// `createElement`çš„è¯­æ³•å¦‚ä¸‹ï¼š
			// createElement(
			// 	// {String | Object | Function}
			// 	'div', // in this case a string
			// 	{
			// 		'class': ...
			// 		style: ...
			// 		attrs: ...
			// 		props: ...
			// 		domProps: ...
			// 		on: {
			// 			click: ...
			// 			input: ...
			// 			...
			// 		},
			// 		nativeOn: {
			// 			input: ...
			// 			...
			// 		},
			// 		directives: ...
			// 		slot: ...
			// 		key: ...
			// 		ref: ...
			// 	},
			// 	[... an array of children ... ]
			// )


			functional: true,
			render: function(createElement, context) {
				let decoratedGift = createElement(context.props.decoration, context.props.gift)
				return createElement(
					'p', 
					{class: 'word'},
					['Dear John, thanks for ', decoratedGift]
					)
			},
			props: {
				gift: String,
				decoration: String
			}
		})
		new Vue({
			el: '#app'
		})
	</script>
	
	<div id="app2">
		<light-bulb></light-bulb>
		<light-bulb></light-bulb>
		<light-bulb></light-bulb>
	</div>
	<script type="text/javascript">
		// åˆ›å»ºä¸€ä¸ªç»„ä»¶: `Vue.component('name-of-component', { ... options ... })`
		// å› ä¸ºHTMLæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼Œæ‰€ä»¥Vueä¼šå°†é©¼å³°å¼CamelCaseçš„å‘½åè½¬æ¢ä¸ºkebab-case.
		// å…¨å±€æ³¨å†Œç»„ä»¶
		Vue.component('light-bulb', {
			template: `
				<div class='light-bulb'>
					<p> Eureka! </p>
				</div>
				`
		})
		new Vue({el:'#app2'})

		// æœ¬åœ°æ³¨å†Œï¼Œä½¿ç”¨æ—¶é€šè¿‡ `components`å¯¼å…¥ç»„ä»¶ï¼Œè¿™æ ·ç»„ä»¶å°±æœ‰å®Œå…¨åˆ†ç¦»çš„é—®é¢˜
		var ligthBulb = {
			template: `
				<div class='light-bulb'>
					<p> Eureka! </p>
				</div>
				`
		}

		new Vue({
			el: '#app2',
			components: {
				'light-bulb': ligthBulb
			}
		})
	</script>

	<!-- é€šè¿‡ `props` å‘ç»„ä»¶ä¸­ä¼ é€’å‚æ•° -->
	<div id="app3">  <!-- çˆ¶ç»„ä»¶ -->
		<label>Sound level</label>
		<input type="number" v-model.number="soundLevel">
		<!-- å¦‚æœ `level`å‰æ²¡æœ‰å†’å·ï¼Œåˆ™è¡¨ç¤ºå°†åè¾¹çš„å­—ç¬¦ä¸²ä½œä¸ºpropçš„ä¸å¯æ”¹å˜çš„å€¼-->
		<!-- å› ä¸ºHTMLæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼Œjsä¸­ç”¨é©¼å³°å¼å®šä¹‰çš„è¯ï¼Œ:level è¦ä½¿ç”¨ kebab-caseï¼Œå¦åˆ™å¯èƒ½ä¼šæ— æ•ˆ -->
		<!-- å­ç»„ä»¶ -->
		<sound-icon :level="soundLevel" :olevel="soundLevel"></sound-icon>
	</div>
	<script type="text/javascript">
		function MyObject(){}
		Vue.component('sound-icon', {
			template: "<span>{{soundEmojis[level]}}</span>",
			// props æ˜¯ä¸€ä¸ªå•é¡¹é€šä¿¡å±æ€§ï¼Œå‘ç»„ä»¶ä¸­ä¼ é€’å‚æ•°
			// props: ['soundLevel'],
			props: {
				// é™å®šlevelçš„ç±»å‹
				level: [Number, String],
				olevel: {
					type: Number,  // å¯ä»¥è®¾ç½®æˆè‡ªå®šä¹‰ç±»å‹
					required: true,
					default: 0,                // è®¾ç½®é»˜è®¤å€¼
					validator(value) {         // é€šè¿‡ç±»å‹æ£€æµ‹åï¼Œéœ€è¦é€šè¿‡è¯¥è¿‡æ»¤å™¨
						return value >= 0 && value <=3
					}
				}
			},
			// dataæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå¤šä¸ªå­å¯¹è±¡å°†ä¼šå…±äº«è¿™ä¸ªdataå¯¹è±¡
			data () {
				return {
					soundEmojis: ['ğŸ”ˆ','ğŸ”ˆ','ğŸ”‰','ğŸ”Š']
				}
			}
		})
		new Vue({
			el: '#app3',
			data: {
				soundLevel: 0
			}
		})
	</script>

	<!-- ç»„ä»¶é—´é€šä¿¡ -->
	<div id="app4">
		<blabber></blabber>
		<blabber></blabber>
	</div>
	<script type="text/javascript">
	// é€šè¿‡å…¨å±€å˜é‡çš„æ–¹å¼ï¼Œç»„ä»¶é—´é€šä¿¡ï¼Œä¸æ¨èè¿™ç§æ–¹å¼
		// var line = 0
		Vue.component('blabber', {
			template: "<p>{{dialogue[currentLine]}}</p>",
			data () {
				return {
					currentLine: 0,
					dialogue: [
						'hello',
						'how are you?',
						'fine thanks',
						'let\'s go drink!',
						'alright, where?',
						'to hello\'s bar',
						'hello?'
					]
				}
			},
			// hook å‡½æ•°ï¼Œç»„ä»¶è¢«æŒ‚è½½ä¹‹åï¼Œæ‰§è¡Œ
			mounted () {
				// setInterval(()=>{
				// 	this.currentLine = line % this.dialogue.length
				// 	line += 1
				// }, 2000)
			}
		})
		new Vue({el:'#app4'})
	</script>

	<!-- ä½¿ç”¨äº‹ä»¶æ¥å®ç°ç»„ä»¶é—´é€šä¿¡ -->
	<div id="app5">
		<blabber2 :ice-breaker="true"></blabber2>
		<blabber2></blabber2>
	</div>
	<script type="text/javascript">
	// æ–°å»ºä¸€ä¸ªVueå®ä¾‹æ¥è¿›è¡Œç»„ä»¶é—´é€šä¿¡
		var bus = new Vue()
		Vue.component('blabber2', {
			template: "<p>{{dialogue[currentLine]}}</p>",
			props: {
				iceBreaker: {
					type: Boolean,
					default: false
				}
			},
			data () {
				return {
					currentLine: this.iceBreaker ? 0: -1,
					dialogue: [
						'hello',
						'how are you?',
						'fine thanks',
						'let\'s go drink!',
						'alright, where?',
						'to hello\'s bar',
						'hello?'
					]
				}
			},
			created() {
				bus.$on('line', line => {
					if (line != this.currentLine) { // ç¡®ä¿ä¸æ˜¯æœ¬ç»„ä»¶å‘é€çš„lineä¿¡æ¯
						setTimeout(()=>{
							this.currentLine = (line + 1) % this.dialogue.length
							bus.$emit('line', this.currentLine)
						}, 2000)
					}
				})
			},
			mounted () {
				if (this.iceBreaker) {
					bus.$emit('line', 0)
				}
			}
		})
		new Vue({el:'#app5'})
	</script>

	<!-- ä½¿ç”¨Vuexè¿›è¡Œé€šä¿¡ -->
	<style type="text/css">
		.blabber {
			width: 200px;
			height: 40px;
			background-color: gainsboro;
			border: 1px solid grey;
		}
	</style>
	<div id="app6">
		<blabber-store></blabber-store>
		<blabber-store></blabber-store>
		<blabber-store></blabber-store>
	</div>
	<script type="text/javascript">
		const store = new Vuex.Store({
			strict: true, // æ¯æ¬¡æ›´æ–°çŠ¶æ€åï¼Œéƒ½ä¼šåœ¨logä¸­æ˜¾ç¤º
			state: {
				currentActor: -1,
				currentLine: -1,
				actors: [],
				dialogue: [
					'Where are you going?',
					'To the cinema',
					'What\'s on at the cinema?',
					'\'Quo vadis?\'',
					'Oh, what does it mean?'
				]
			},
			mutations: {
				entersScene (state, uuid) {
					state.currentLine = (state.currentLine + 1) % state.dialogue.length
					state.actors.push({
						uuid,
						line: state.dialogue[state.currentLine]
					})
					state.currentActor = (state.currentActor + 1) % state.actors.length
				},
				nextLine (state) {
					state.currentActor = (state.currentActor + 1) % state.actors.length
					state.currentLine =	(state.currentLine + 1) % state.dialogue.length
					state.actors[state.currentActor].line =	state.dialogue[state.currentLine]
				}
			}
		})
		Vue.component('blabber-store', {
			template: '<div class="blabber">{{currentLine}}</div>',
			data () {
				return {
					uuid: Math.random()
				}
			},
			computed: {
				currentLine () {
					return store.state.actors.find(actor => actor.uuid === this.uuid).line
				}
			},
			created () {
				store.commit('entersScene', this.uuid)
			}
		})
		new Vue({
			el: '#app6',
			mounted () {
				setInterval(() => {
					store.commit('nextLine')
				}, 2000)
			}
		})
	</script>

	<!-- ç›´æ¥è¯»å–å­ç»„ä»¶çš„çŠ¶æ€ ï¼š é€‚åˆäºç´§è€¦åˆç»„ä»¶ -->
	<div id="app7">
	    <!-- å¯ä»¥é€šè¿‡ `ref` å±æ€§è·å–ç»„ä»¶çš„æ ‡è®°ï¼Œè¯¥å€¼ä¸æ˜¯reactiveï¼Œæ‰€ä»¥ä¸èƒ½å°†å…¶ç»‘å®šåˆ°å˜é‡ä¸Š -->
		<child ref="junior"></child>
		<p> Truth: {{childStomach}} </p>
	</div>
	<script type="text/javascript">
		Vue.component('child', {
			template: "<p>{{mouth}}</p>",
			data () {
				return {
					mouth: 'I didn\'t eat that cookie',
					stomach: 'Yummy that cookie was delicious.'
				}
			}
		})

		new Vue({
			el: '#app7',
			data: {
				childStomach: 'unknown'
			},
			mounted () {
				this.childStomach = this.$refs.junior.stomach
			}
		})
	</script>
</body>
</html>